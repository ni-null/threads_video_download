# Threads 影片下載器 - Chrome V3 外掛

這是一個 Chrome V3 版本的外掛，用於自動擷取和下載 Threads.com 上的媒體檔案。

## 功能特性

✨ **自動媒體檢測**
- 自動掃描頁面上的影片和圖片
- 監聽所有網絡請求，捕捉媒體檔案
- 支援 Fetch API 和 XMLHttpRequest 攔截

📥 **下載功能**
- 逐個下載媒體檔案
- 批量下載所有媒體
- 自訂下載位置到 `Threads/` 資料夾

📋 **便捷操作**
- 複製媒體連結到剪貼簿
- 清除媒體列表
- 實時顯示檢測到的媒體數量

🎨 **用戶界面**
- 美觀的彈出窗口設計
- 彩色分類（圖片/影片）
- 響應式設計

## 安裝方法

### 方式一：開發者模式安裝（推薦）

1. 打開 Chrome 瀏覽器
2. 進入 `chrome://extensions/`
3. 打開右上角的「開發人員模式」開關
4. 點擊「加載未封裝的擴充功能」
5. 選擇本項目的資料夾 `threads_video_download`
6. 外掛會自動安裝並出現在擴充功能列表中

### 方式二：打包安裝

```bash
# 使用 Chrome 命令行工具打包
# 需要先安裝 Node.js 和 Chrome Extension Packer
```

## 使用方法

1. **訪問 Threads**
   - 進入 `https://www.threads.com/?hl=zh-tw`

2. **自動掃描**
   - 外掛會自動開始掃描頁面上的媒體
   - 滾動頁面加載更多內容時，外掛會持續檢測

3. **打開下載器**
   - 點擊 Chrome 工具欄上的外掛圖標
   - 會彈出下載器窗口

4. **下載選項**
   - 📋 複製：複製媒體連結到剪貼簿
   - ⬇️ 下載：下載單個媒體檔案
   - 下載全部：一次下載所有檢測到的媒體
   - 清除列表：清空媒體列表

## 文件結構

```
threads_video_download/
├── manifest.json          # 外掛配置文件
├── background.js          # 背景服務工作線程
├── content.js            # 內容腳本（注入網頁）
├── popup.html            # 彈出窗口 HTML
├── popup.js              # 彈出窗口邏輯
├── popup.css             # 彈出窗口樣式
├── icons/                # 外掛圖標
│   ├── icon-16.png
│   ├── icon-48.png
│   └── icon-128.png
└── README.md             # 說明文檔
```

## 權限說明

- `activeTab`: 訪問當前活動標籤
- `scripting`: 在頁面中注入腳本
- `storage`: 儲存媒體資訊
- `host_permissions`: 僅在 `https://www.threads.com/*` 上運行

## 工作原理

### 媒體檢測流程

1. **Fetch/XHR 攔截**
   - 監聽所有 `fetch()` 和 `XMLHttpRequest` 請求
   - 檢查內容類型是否為視頻或圖片

2. **DOM 掃描**
   - 掃描頁面中的 `<video>` 和 `<img>` 標籤
   - 檢查 `src` 和 `data-src` 屬性

3. **動態監控**
   - 使用 `MutationObserver` 監聽 DOM 變化
   - 每 2 秒進行一次完整掃描
   - 檢查背景圖片和 Performance API 記錄

4. **數據存儲**
   - 使用 `chrome.storage.local` 儲存媒體列表
   - 避免重複存儲相同的 URL

## 下載行為

- 檔案保存到 `Downloads/Threads/` 資料夾
- 自動添加副檔名
- 檔名衝突時自動重命名（e.g., `file (1).mp4`）

## 已知限制

- ⚠️ 某些受 CORS 保護的媒體可能無法下載
- ⚠️ 直播視頻流可能需要特殊處理
- ⚠️ 某些 CDN 加密的內容無法直接訪問

## 故障排除

### 外掛未檢測到媒體

1. 確保外掛已啟用（在 `chrome://extensions/` 中檢查）
2. 刷新頁面，讓外掛重新掃描
3. 打開控制台（F12），查看是否有錯誤信息
4. 滾動頁面，加載更多內容

### 下載失敗

1. 檢查網絡連接
2. 確保下載位置有寫入權限
3. 某些受保護的媒體可能需要額外授權
4. 嘗試在新標籤頁中直接打開媒體 URL

## 更新日誌

### v1.0 (2024)
- ✅ 初始版本發佈
- ✅ 實現基本的媒體檢測功能
- ✅ 添加下載和複製功能
- ✅ 美化用戶界面

## 許可證

MIT License

## 貢獻

歡迎提交 Issue 和 Pull Request！

## 免責聲明

此外掛僅供個人使用。使用者應遵守 Threads.com 的服務條款和當地法律。
作者不對使用此外掛造成的任何問題負責。

## 聯繫方式

如有問題或建議，請提交 Issue。

---

**注意**: 此外掛未在 Chrome Web Store 中發佈，只能通過開發者模式安裝。
